var express = require('express'), path = require('path'), url = require('url');

var context = function (req, resp) {
    var parts = url.parse(req.url).pathname.split('/');
    this.controllerRoot = './controllers';
    this.controllerName = parts[1];
    this.viewName = parts[2];
    this.method = req.method.toLowerCase();
    this.request = req;
    this.response = resp;
};

context.prototype.invoke = function () {
    // path.join(this.controllerRoot, this.controllerName, this.viewName, this.method)
    this.controller().render(this);
};

context.prototype.view = function (options, subview) {
    var viewPath = url.parse(this.request.url).pathname.substring(1);
    if (subview) viewPath = [viewPath, subview].join('/');
    this.response.render(
        viewPath,
        options);
};

context.prototype.controller = function () {
    return require(path.resolve([this.controllerRoot, this.controllerName, this.viewName, this.method].join('/')));
};

exports.context = context;